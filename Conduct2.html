<!DOCTYPE html>
<html>
<head>
    <title>แบบฟอร์ม LIFF</title>
    <script src="https://static.line-scdn.net/liff/edge/2.0/sdk.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <form id="myForm">
        <input type="hidden" id="userLineId">
        <label for="name">ชื่อ:</label>
        <input type="text" id="name" required><br><br>
        <label for="keynumber">เลขประจำตัว:</label>
        <input type="text" id="keynumber" required><br><br>
        <label for="signature">ลายเซ็น:</label><br>
        <canvas id="signatureCanvas" width="400" height="200" style="border:1px solid #000;"></canvas><br>
        <button type="button" id="clearCanvas">ล้างลายเซ็น</button><br><br>
        <button type="button" id="submitBtn">ยืนยัน</button>
    </form>

    <script>
        async function main() {
            await liff.init({ liffId: "2007047383-9n1A0g3Y" }); // แทนที่ YOUR_LIFF_ID ด้วย LIFF ID ของคุณ
            if (liff.isLoggedIn()) {
                const profile = await liff.getProfile();
                document.getElementById("userLineId").value = profile.userId;
            } else {
                liff.login();
            }

            // Canvas สำหรับลายเซ็น
            const canvas = document.getElementById("signatureCanvas");
            const ctx = canvas.getContext("2d");
            let drawing = false;

            canvas.addEventListener("mousedown", (e) => {
                drawing = true;
                ctx.beginPath();
                ctx.moveTo(e.offsetX, e.offsetY);
            });

            canvas.addEventListener("mousemove", (e) => {
                if (!drawing) return;
                ctx.lineTo(e.offsetX, e.offsetY);
                ctx.stroke();
            });

            canvas.addEventListener("mouseup", () => {
                drawing = false;
            });

            document.getElementById("clearCanvas").addEventListener("click", () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            });

            document.getElementById("submitBtn").addEventListener("click", async () => {
                const userLineId = document.getElementById("userLineId").value;
                const name = document.getElementById("name").value;
                const keynumber = document.getElementById("keynumber").value;
                const signatureDataUrl = canvas.toDataURL("image/png");

                const response = await fetch("https://script.google.com/macros/s/AKfycbzSerwuPr3tV_kb_bWIayfabD_wCVk_iSVj0gjyBjeek70aeEtIK3aTiHh17VZD0Gtq/exec", { // แทนที่ YOUR_APPS_SCRIPT_URL ด้วย URL ของ Apps Script ของคุณ
                    method: "POST",
                    body: JSON.stringify({ userLineId, name, keynumber, signatureDataUrl }),
                    headers: {
                        "Content-Type": "application/json",
                    },
                });

                if (response.ok) {
                    Swal.fire({
                        icon: "success",
                        title: "บันทึกข้อมูลสำเร็จ!",
                    });
                } else {
                    Swal.fire({
                        icon: "error",
                        title: "เกิดข้อผิดพลาดในการบันทึกข้อมูล",
                    });
                }
            });
        }

        main();
    </script>
</body>
</html>
